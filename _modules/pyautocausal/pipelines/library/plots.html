<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyautocausal.pipelines.library.plots &mdash; PyAutoCausal 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            PyAutoCausal
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started.html">Getting Started with PyAutoCausal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#your-first-analysis-feature-rollout-impact">Your First Analysis: Feature Rollout Impact</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#step-1-prepare-your-data">Step 1: Prepare Your Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#step-2-run-the-analysis">Step 2: Run the Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#step-3-examine-the-results">Step 3: Examine the Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#step-4-interpret-your-results">Step 4: Interpret Your Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#understanding-what-pyautocausal-did">Understanding What PyAutoCausal Did</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#common-data-scenarios">Common Data Scenarios</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#scenario-1-single-time-period-cross-sectional">Scenario 1: Single Time Period (Cross-sectional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#scenario-2-single-treated-unit">Scenario 2: Single Treated Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#scenario-3-large-dataset">Scenario 3: Large Dataset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#next-steps">Next Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting-started.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#common-issues">Common Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../getting-started.html#getting-help">Getting Help</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data-requirements.html">Data Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#core-data-structure">Core Data Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#required-columns">Required Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#optional-columns">Optional Columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#example-dataset-structure">Example Dataset Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#data-formatting-requirements">Data Formatting Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#treatment-variable-treat">1. Treatment Variable (<code class="docutils literal notranslate"><span class="pre">treat</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#time-variable-t">2. Time Variable (<code class="docutils literal notranslate"><span class="pre">t</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#unit-id-id-unit">3. Unit ID (<code class="docutils literal notranslate"><span class="pre">id_unit</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#missing-values">4. Missing Values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#common-data-scenarios">Common Data Scenarios</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#scenario-1-staggered-treatment-adoption">Scenario 1: Staggered Treatment Adoption</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#scenario-2-geographic-policy-analysis">Scenario 2: Geographic Policy Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#scenario-3-marketing-campaign-analysis">Scenario 3: Marketing Campaign Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#data-validation">Data Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#common-validation-issues">Common Validation Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#data-size-considerations">Data Size Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#minimum-requirements">Minimum Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#performance-guidelines">Performance Guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../data-requirements.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#data-quality">1. Data Quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#treatment-timing">2. Treatment Timing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../data-requirements.html#outcome-variable">3. Outcome Variable</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Example Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#example-1-california-proposition-99-synthetic-control">Example 1: California Proposition 99 (Synthetic Control)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#dataset">Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#what-the-pipeline-does">What the Pipeline Does</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#pipeline-execution-graph">Pipeline Execution Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#key-results">Key Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#example-2-minimum-wage-study-staggered-did">Example 2: Minimum Wage Study (Staggered DiD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#id1">Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#id2">What the Pipeline Does</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#id3">Pipeline Execution Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#id4">Key Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#understanding-the-graph-visualization">Understanding the Graph Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#node-types">Node Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../examples.html#node-states">Node States</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../examples.html#running-your-own-analysis">Running Your Own Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#module-pyautocausal.orchestration.graph">Orchestration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.__init__"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.configure_runtime"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.configure_runtime()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.input_nodes"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.input_nodes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_ready_nodes"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_ready_nodes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_running_nodes"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_running_nodes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.is_execution_finished"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.is_execution_finished()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_incomplete_nodes"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_incomplete_nodes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.save_node_output"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.save_node_output()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.execute_graph"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.execute_graph()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.fit"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.create_node"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.create_node()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.add_node_to_graph"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.add_node_to_graph()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.add_node"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.add_node()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.create_input_node"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.create_input_node()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.merge_with"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.merge_with()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.to_text"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.to_text()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.print_graph"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.print_graph()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_node_predecessors"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_node_predecessors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_node_successors"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_node_successors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.get_node_predecessor_outputs"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.get_node_predecessor_outputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.is_node_ready"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.is_node_ready()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.validate_node_graph_consistency"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.validate_node_graph_consistency()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.can_wire_nodes"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.can_wire_nodes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.add_node_with_predecessors"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.add_node_with_predecessors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.add_edge"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.add_edge()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.create_decision_node"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.create_decision_node()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.when_true"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.when_true()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.when_false"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.when_false()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.__getstate__"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.__getstate__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.__setstate__"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.__setstate__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.to_yaml"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.to_yaml()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.graph.ExecutableGraph.from_yaml"><code class="docutils literal notranslate"><span class="pre">ExecutableGraph.from_yaml()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.NodeExecutionError"><code class="docutils literal notranslate"><span class="pre">NodeExecutionError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.NodeExecutionError.__init__"><code class="docutils literal notranslate"><span class="pre">NodeExecutionError.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.is_lambda"><code class="docutils literal notranslate"><span class="pre">is_lambda()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.BaseNode"><code class="docutils literal notranslate"><span class="pre">BaseNode</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.BaseNode.__init__"><code class="docutils literal notranslate"><span class="pre">BaseNode.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node"><code class="docutils literal notranslate"><span class="pre">Node</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.__init__"><code class="docutils literal notranslate"><span class="pre">Node.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.validate_action_function_static"><code class="docutils literal notranslate"><span class="pre">Node.validate_action_function_static()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.__rshift__"><code class="docutils literal notranslate"><span class="pre">Node.__rshift__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.execute"><code class="docutils literal notranslate"><span class="pre">Node.execute()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.mark_running"><code class="docutils literal notranslate"><span class="pre">Node.mark_running()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.mark_completed"><code class="docutils literal notranslate"><span class="pre">Node.mark_completed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.mark_failed"><code class="docutils literal notranslate"><span class="pre">Node.mark_failed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.mark_passed"><code class="docutils literal notranslate"><span class="pre">Node.mark_passed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.is_completed"><code class="docutils literal notranslate"><span class="pre">Node.is_completed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.is_running"><code class="docutils literal notranslate"><span class="pre">Node.is_running()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.is_passed"><code class="docutils literal notranslate"><span class="pre">Node.is_passed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.Node.get_result_value"><code class="docutils literal notranslate"><span class="pre">Node.get_result_value()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode"><code class="docutils literal notranslate"><span class="pre">DecisionNode</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.__init__"><code class="docutils literal notranslate"><span class="pre">DecisionNode.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.add_execute_when_true"><code class="docutils literal notranslate"><span class="pre">DecisionNode.add_execute_when_true()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.add_execute_when_false"><code class="docutils literal notranslate"><span class="pre">DecisionNode.add_execute_when_false()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.validate_branches"><code class="docutils literal notranslate"><span class="pre">DecisionNode.validate_branches()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.condition_satisfied"><code class="docutils literal notranslate"><span class="pre">DecisionNode.condition_satisfied()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.DecisionNode.mark_unreachable_nodes_as_passed"><code class="docutils literal notranslate"><span class="pre">DecisionNode.mark_unreachable_nodes_as_passed()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.InputNode"><code class="docutils literal notranslate"><span class="pre">InputNode</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.InputNode.__init__"><code class="docutils literal notranslate"><span class="pre">InputNode.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.nodes.InputNode.set_input"><code class="docutils literal notranslate"><span class="pre">InputNode.set_input()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node"><code class="docutils literal notranslate"><span class="pre">Node</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.name"><code class="docutils literal notranslate"><span class="pre">Node.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.output"><code class="docutils literal notranslate"><span class="pre">Node.output</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.output_config"><code class="docutils literal notranslate"><span class="pre">Node.output_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.is_running"><code class="docutils literal notranslate"><span class="pre">Node.is_running()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.is_completed"><code class="docutils literal notranslate"><span class="pre">Node.is_completed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.execute"><code class="docutils literal notranslate"><span class="pre">Node.execute()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.orchestration.base.Node.__init__"><code class="docutils literal notranslate"><span class="pre">Node.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#module-pyautocausal.pipelines.library.specifications">Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.BaseSpec"><code class="docutils literal notranslate"><span class="pre">BaseSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.BaseSpec.data"><code class="docutils literal notranslate"><span class="pre">BaseSpec.data</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.BaseSpec.formula"><code class="docutils literal notranslate"><span class="pre">BaseSpec.formula</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.BaseSpec.__init__"><code class="docutils literal notranslate"><span class="pre">BaseSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.CrossSectionalSpec"><code class="docutils literal notranslate"><span class="pre">CrossSectionalSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.CrossSectionalSpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">CrossSectionalSpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.CrossSectionalSpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">CrossSectionalSpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.CrossSectionalSpec.control_cols"><code class="docutils literal notranslate"><span class="pre">CrossSectionalSpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.CrossSectionalSpec.__init__"><code class="docutils literal notranslate"><span class="pre">CrossSectionalSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec"><code class="docutils literal notranslate"><span class="pre">DiDSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">DiDSpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">DiDSpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.control_cols"><code class="docutils literal notranslate"><span class="pre">DiDSpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.time_col"><code class="docutils literal notranslate"><span class="pre">DiDSpec.time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.unit_col"><code class="docutils literal notranslate"><span class="pre">DiDSpec.unit_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.post_col"><code class="docutils literal notranslate"><span class="pre">DiDSpec.post_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.include_unit_fe"><code class="docutils literal notranslate"><span class="pre">DiDSpec.include_unit_fe</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.include_time_fe"><code class="docutils literal notranslate"><span class="pre">DiDSpec.include_time_fe</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.model"><code class="docutils literal notranslate"><span class="pre">DiDSpec.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.DiDSpec.__init__"><code class="docutils literal notranslate"><span class="pre">DiDSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec"><code class="docutils literal notranslate"><span class="pre">EventStudySpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.control_cols"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.time_col"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.unit_col"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.unit_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.relative_time_col"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.relative_time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.event_cols"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.event_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.reference_period"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.reference_period</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.model"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.EventStudySpec.__init__"><code class="docutils literal notranslate"><span class="pre">EventStudySpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.control_cols"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.time_col"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.unit_col"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.unit_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.treatment_time_col"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.treatment_time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.model"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.StaggeredDiDSpec.__init__"><code class="docutils literal notranslate"><span class="pre">StaggeredDiDSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.control_cols"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.time_col"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.time_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.unit_col"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.unit_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.Y"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.Y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.N0"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.N0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.T0"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.T0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.X"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.X</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.model"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.SynthDIDSpec.__init__"><code class="docutils literal notranslate"><span class="pre">SynthDIDSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec"><code class="docutils literal notranslate"><span class="pre">UpliftSpec</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.outcome_col"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.outcome_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.treatment_cols"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.treatment_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.control_cols"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.control_cols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.unit_col"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.unit_col</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.model"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.propensity_score"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.propensity_score</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.cate_estimates"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.cate_estimates</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.ate_estimate"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.ate_estimate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.ate_ci"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.ate_ci</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.model_type"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.model_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.models"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.models</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.evaluation_metrics"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.evaluation_metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.UpliftSpec.__init__"><code class="docutils literal notranslate"><span class="pre">UpliftSpec.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.validate_and_prepare_data"><code class="docutils literal notranslate"><span class="pre">validate_and_prepare_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.specifications.spec_constructor"><code class="docutils literal notranslate"><span class="pre">spec_constructor()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.estimators.create_model_matrices"><code class="docutils literal notranslate"><span class="pre">create_model_matrices()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.estimators.extract_treatment_from_design"><code class="docutils literal notranslate"><span class="pre">extract_treatment_from_design()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.conditions.is_continuous"><code class="docutils literal notranslate"><span class="pre">is_continuous()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.conditions.index_relative_time"><code class="docutils literal notranslate"><span class="pre">index_relative_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.conditions.has_binary_treatment_and_outcome"><code class="docutils literal notranslate"><span class="pre">has_binary_treatment_and_outcome()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.pipelines.library.plots.create_did_plot"><code class="docutils literal notranslate"><span class="pre">create_did_plot()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#causal-methods">Causal Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#module-pyautocausal.persistence.output_config">Persistence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_config.OutputConfig"><code class="docutils literal notranslate"><span class="pre">OutputConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_config.OutputConfig.output_type"><code class="docutils literal notranslate"><span class="pre">OutputConfig.output_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_config.OutputConfig.output_filename"><code class="docutils literal notranslate"><span class="pre">OutputConfig.output_filename</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_config.OutputConfig.__post_init__"><code class="docutils literal notranslate"><span class="pre">OutputConfig.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_config.OutputConfig.__init__"><code class="docutils literal notranslate"><span class="pre">OutputConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.UnsupportedOutputTypeError"><code class="docutils literal notranslate"><span class="pre">UnsupportedOutputTypeError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler"><code class="docutils literal notranslate"><span class="pre">OutputHandler</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.SAVE_METHOD_MAP"><code class="docutils literal notranslate"><span class="pre">OutputHandler.SAVE_METHOD_MAP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.__init__"><code class="docutils literal notranslate"><span class="pre">OutputHandler.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_csv"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_csv()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_parquet"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_parquet()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_json"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_pickle"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_pickle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_text"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_text()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_png"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_png()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.output_handler.OutputHandler.save_bytes"><code class="docutils literal notranslate"><span class="pre">OutputHandler.save_bytes()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.notebook_export.NotebookExporter"><code class="docutils literal notranslate"><span class="pre">NotebookExporter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.notebook_export.NotebookExporter.__init__"><code class="docutils literal notranslate"><span class="pre">NotebookExporter.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.notebook_export.NotebookExporter.export_notebook"><code class="docutils literal notranslate"><span class="pre">NotebookExporter.export_notebook()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.notebook_export.NotebookExporter.export_and_run_to_html"><code class="docutils literal notranslate"><span class="pre">NotebookExporter.export_and_run_to_html()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.persistence.notebook_export.NotebookExporter.run_existing_notebook_to_html"><code class="docutils literal notranslate"><span class="pre">NotebookExporter.run_existing_notebook_to_html()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#module-pyautocausal.data_validation.validator_base">Data Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidationError"><code class="docutils literal notranslate"><span class="pre">DataValidationError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidationError.__init__"><code class="docutils literal notranslate"><span class="pre">DataValidationError.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidationError.__str__"><code class="docutils literal notranslate"><span class="pre">DataValidationError.__str__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.passed"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.passed</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.individual_results"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.individual_results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.summary"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.summary</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#id0"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.passed</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#id1"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.individual_results</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#id2"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.summary</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.__post_init__"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.get_all_issues"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.get_all_issues()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.get_failed_checks"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.get_failed_checks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.to_string"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.to_string()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.AggregatedValidationResult.__init__"><code class="docutils literal notranslate"><span class="pre">AggregatedValidationResult.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig.fail_on_warning"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig.fail_on_warning</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig.aggregation_strategy"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig.aggregation_strategy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig.check_configs"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig.check_configs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig.enabled_checks"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig.enabled_checks</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidatorConfig.__init__"><code class="docutils literal notranslate"><span class="pre">DataValidatorConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidator"><code class="docutils literal notranslate"><span class="pre">DataValidator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidator.__init__"><code class="docutils literal notranslate"><span class="pre">DataValidator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidator.validate"><code class="docutils literal notranslate"><span class="pre">DataValidator.validate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.validator_base.DataValidator.__call__"><code class="docutils literal notranslate"><span class="pre">DataValidator.__call__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataConfig"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataConfig.min_rows"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataConfig.min_rows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataConfig.min_columns"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataConfig.min_columns</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataConfig.__init__"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataCheck"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataCheck.name"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NonEmptyDataCheck.validate"><code class="docutils literal notranslate"><span class="pre">NonEmptyDataCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsConfig"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsConfig.required_columns"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsConfig.required_columns</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsConfig.case_sensitive"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsConfig.case_sensitive</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsConfig.__init__"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsCheck"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsCheck.name"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.RequiredColumnsCheck.validate"><code class="docutils literal notranslate"><span class="pre">RequiredColumnsCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesConfig"><code class="docutils literal notranslate"><span class="pre">ColumnTypesConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesConfig.expected_types"><code class="docutils literal notranslate"><span class="pre">ColumnTypesConfig.expected_types</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesConfig.type_checkers"><code class="docutils literal notranslate"><span class="pre">ColumnTypesConfig.type_checkers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesConfig.__init__"><code class="docutils literal notranslate"><span class="pre">ColumnTypesConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesCheck"><code class="docutils literal notranslate"><span class="pre">ColumnTypesCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesCheck.name"><code class="docutils literal notranslate"><span class="pre">ColumnTypesCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">ColumnTypesCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.ColumnTypesCheck.validate"><code class="docutils literal notranslate"><span class="pre">ColumnTypesCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsConfig"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsConfig.case_sensitive"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsConfig.case_sensitive</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsConfig.__init__"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsCheck"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsCheck.name"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.NoDuplicateColumnsCheck.validate"><code class="docutils literal notranslate"><span class="pre">NoDuplicateColumnsCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsConfig"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsConfig.subset"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsConfig.subset</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsConfig.keep"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsConfig.keep</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsConfig.max_duplicate_fraction"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsConfig.max_duplicate_fraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsConfig.__init__"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsCheck"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsCheck.name"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.basic_checks.DuplicateRowsCheck.validate"><code class="docutils literal notranslate"><span class="pre">DuplicateRowsCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentConfig"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentConfig.allow_missing"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentConfig.allow_missing</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentConfig.valid_values"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentConfig.valid_values</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentConfig.__init__"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentCheck"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentCheck.name"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.BinaryTreatmentCheck.validate"><code class="docutils literal notranslate"><span class="pre">BinaryTreatmentCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.min_treated_fraction"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.min_treated_fraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.max_treated_fraction"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.max_treated_fraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.min_treated_count"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.min_treated_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.min_control_count"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.min_control_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationConfig.__init__"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationCheck"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationCheck.name"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentVariationCheck.validate"><code class="docutils literal notranslate"><span class="pre">TreatmentVariationCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig.unit_column"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig.unit_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig.time_column"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig.require_balanced"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig.require_balanced</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureConfig.__init__"><code class="docutils literal notranslate"><span class="pre">PanelStructureConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureCheck"><code class="docutils literal notranslate"><span class="pre">PanelStructureCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureCheck.name"><code class="docutils literal notranslate"><span class="pre">PanelStructureCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">PanelStructureCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.PanelStructureCheck.validate"><code class="docutils literal notranslate"><span class="pre">PanelStructureCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig.time_column"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig.require_sequential"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig.require_sequential</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig.require_numeric"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig.require_numeric</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig.date_format"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig.date_format</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnConfig.__init__"><code class="docutils literal notranslate"><span class="pre">TimeColumnConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnCheck"><code class="docutils literal notranslate"><span class="pre">TimeColumnCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnCheck.name"><code class="docutils literal notranslate"><span class="pre">TimeColumnCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">TimeColumnCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimeColumnCheck.validate"><code class="docutils literal notranslate"><span class="pre">TimeColumnCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig.unit_column"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig.unit_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig.time_column"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig.allow_treatment_reversals"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig.allow_treatment_reversals</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceConfig.__init__"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceCheck"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceCheck.name"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentPersistenceCheck.validate"><code class="docutils literal notranslate"><span class="pre">TreatmentPersistenceCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig.outcome_column"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig.outcome_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig.min_variation_threshold"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig.min_variation_threshold</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig.outlier_threshold"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig.outlier_threshold</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig.require_numeric"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig.require_numeric</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableConfig.__init__"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableCheck"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableCheck.name"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.OutcomeVariableCheck.validate"><code class="docutils literal notranslate"><span class="pre">OutcomeVariableCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.unit_column"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.unit_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.time_column"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.min_pre_periods"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.min_pre_periods</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.min_post_periods"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.min_post_periods</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.min_control_units"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.min_control_units</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.min_never_treated_fraction"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.min_never_treated_fraction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsConfig.__init__"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsCheck"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsCheck.name"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.CausalMethodRequirementsCheck.validate"><code class="docutils literal notranslate"><span class="pre">CausalMethodRequirementsCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig.unit_column"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig.unit_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig.time_column"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig.check_simultaneous_adoption"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig.check_simultaneous_adoption</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsConfig.__init__"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsCheck"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsCheck.name"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TreatmentTimingPatternsCheck.validate"><code class="docutils literal notranslate"><span class="pre">TreatmentTimingPatternsCheck.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationConfig"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationConfig.treatment_column"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationConfig.treatment_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationConfig.time_column"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationConfig.time_column</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationConfig.__init__"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationCheck"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationCheck</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationCheck.name"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationCheck.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationCheck.get_default_config"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationCheck.get_default_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_validation.checks.causal_checks.TimePeriodStandardizationCheck.validate"><code class="docutils literal notranslate"><span class="pre">TimePeriodStandardizationCheck.validate()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/index.html#module-pyautocausal.data_cleaning.cleaner">Data Cleaning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.cleaner.DataCleaner"><code class="docutils literal notranslate"><span class="pre">DataCleaner</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.cleaner.DataCleaner.__init__"><code class="docutils literal notranslate"><span class="pre">DataCleaner.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.cleaner.DataCleaner.clean"><code class="docutils literal notranslate"><span class="pre">DataCleaner.clean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.cleaner.DataCleaner.__call__"><code class="docutils literal notranslate"><span class="pre">DataCleaner.__call__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.planner.DataCleaningPlanner"><code class="docutils literal notranslate"><span class="pre">DataCleaningPlanner</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.planner.DataCleaningPlanner.__init__"><code class="docutils literal notranslate"><span class="pre">DataCleaningPlanner.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.planner.DataCleaningPlanner.create_plan"><code class="docutils literal notranslate"><span class="pre">DataCleaningPlanner.create_plan()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/index.html#pyautocausal.data_cleaning.planner.DataCleaningPlanner.__call__"><code class="docutils literal notranslate"><span class="pre">DataCleaningPlanner.__call__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">PyAutoCausal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyautocausal.pipelines.library.plots</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyautocausal.pipelines.library.plots</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plot functions for causal inference visualizations</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyautocausal.pipelines.library.specifications</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseSpec</span><span class="p">,</span> <span class="n">DiDSpec</span><span class="p">,</span> <span class="n">StaggeredDiDSpec</span><span class="p">,</span> <span class="n">EventStudySpec</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyautocausal.persistence.parameter_mapper</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_transformable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyautocausal.persistence.output_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">OutputConfig</span><span class="p">,</span> <span class="n">OutputType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyautocausal.pipelines.library.synthdid.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_synthdid</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">pyautocausal.pipelines.library.specifications</span><span class="w"> </span><span class="kn">import</span> <span class="n">UpliftSpec</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_get_confidence_intervals</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to get confidence intervals from both statsmodels and linearmodels results.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        model: Fitted model (statsmodels or linearmodels result)</span>
<span class="sd">        confidence_level: Confidence level (e.g., 0.95 for 95% CI)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with confidence intervals with standardized column names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try linearmodels API first (uses level parameter)</span>
        <span class="n">conf_int</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">)</span>
        <span class="c1"># Standardize column names if they&#39;re not already &#39;lower&#39; and &#39;upper&#39;</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">conf_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">conf_int</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fall back to statsmodels API (uses alpha parameter)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span>
            <span class="n">conf_int</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="c1"># Standardize column names if they&#39;re not already &#39;lower&#39; and &#39;upper&#39;</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">conf_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">conf_int</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not get confidence intervals from model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_plot_uplift_curve_native</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Native uplift curve plotting using only matplotlib and pandas.</span>
<span class="sd">    </span>
<span class="sd">    Creates uplift curve showing treatment effect by score deciles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
    
    <span class="c1"># Create analysis dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s1">&#39;uplift&#39;</span><span class="p">:</span> <span class="n">uplift_scores</span><span class="p">,</span>
        <span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment</span>
    <span class="p">})</span>
    
    <span class="c1"># Sort by uplift score (descending) and create deciles</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;uplift&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span> <span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="c1"># Calculate metrics by decile</span>
    <span class="n">decile_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Total observations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Treatment balance: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Outcome rate: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">decile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
        <span class="n">decile_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">decile</span><span class="p">]</span>
        
        <span class="c1"># Treatment and control groups within this decile</span>
        <span class="n">treated</span> <span class="o">=</span> <span class="n">decile_data</span><span class="p">[</span><span class="n">decile_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">decile_data</span><span class="p">[</span><span class="n">decile_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Calculate rates</span>
        <span class="n">treated_rate</span> <span class="o">=</span> <span class="n">treated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">treated</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">control_rate</span> <span class="o">=</span> <span class="n">control</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">control</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">uplift</span> <span class="o">=</span> <span class="n">treated_rate</span> <span class="o">-</span> <span class="n">control_rate</span>
        
        <span class="c1"># Sample sizes</span>
        <span class="n">n_treated</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">treated</span><span class="p">)</span>
        <span class="n">n_control</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
        
        <span class="c1"># Debug information for problematic deciles</span>
        <span class="k">if</span> <span class="n">n_treated</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n_control</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Decile </span><span class="si">{</span><span class="n">decile</span><span class="si">}</span><span class="s2"> has imbalanced groups - Treated: </span><span class="si">{</span><span class="n">n_treated</span><span class="si">}</span><span class="s2">, Control: </span><span class="si">{</span><span class="n">n_control</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Standard error for uplift (approximate)</span>
        <span class="k">if</span> <span class="n">n_treated</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n_control</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">se_treated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">treated_rate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">treated_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_treated</span><span class="p">)</span> <span class="k">if</span> <span class="n">treated_rate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">se_control</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">control_rate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">control_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_control</span><span class="p">)</span> <span class="k">if</span> <span class="n">control_rate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">uplift_se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">se_treated</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">se_control</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uplift_se</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">decile_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;decile&#39;</span><span class="p">:</span> <span class="n">decile</span><span class="p">,</span>
            <span class="s1">&#39;uplift&#39;</span><span class="p">:</span> <span class="n">uplift</span><span class="p">,</span>
            <span class="s1">&#39;uplift_se&#39;</span><span class="p">:</span> <span class="n">uplift_se</span><span class="p">,</span>
            <span class="s1">&#39;treated_rate&#39;</span><span class="p">:</span> <span class="n">treated_rate</span><span class="p">,</span>
            <span class="s1">&#39;control_rate&#39;</span><span class="p">:</span> <span class="n">control_rate</span><span class="p">,</span>
            <span class="s1">&#39;n_treated&#39;</span><span class="p">:</span> <span class="n">n_treated</span><span class="p">,</span>
            <span class="s1">&#39;n_control&#39;</span><span class="p">:</span> <span class="n">n_control</span><span class="p">,</span>
            <span class="s1">&#39;avg_score&#39;</span><span class="p">:</span> <span class="n">decile_data</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="p">})</span>
    
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">decile_results</span><span class="p">)</span>
    
    <span class="c1"># Print diagnostic information</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Decile analysis summary:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Decile </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">: uplift=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, n_treated=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_treated&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, n_control=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_control&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the plot</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span>
    <span class="n">yerr</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;uplift_se&#39;</span><span class="p">]</span>
    
    <span class="c1"># Bar plot with error bars - use different colors for different uplift levels</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkred&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.001</span> <span class="k">else</span> <span class="s1">&#39;darkgreen&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="s1">&#39;gray&#39;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Styling</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Uplift Score Decile (1 = Highest Predicted Uplift)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed Uplift (Treated Rate - Control Rate)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Uplift Curve: Observed vs Predicted&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="c1"># Force y-axis to show small values clearly</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
    
    <span class="c1"># Add value labels on bars - show all values including zeros</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">results_df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">())):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="c1"># Show all values, not just meaningful ones</span>
        <span class="n">label_y</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="n">uplift_se</span> <span class="o">+</span> <span class="n">y_max</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span> <span class="o">-</span> <span class="n">row</span><span class="o">.</span><span class="n">uplift_se</span> <span class="o">-</span> <span class="n">y_max</span> <span class="o">*</span> <span class="mf">0.05</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">label_y</span><span class="p">,</span>
               <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
               <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span> <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> 
               <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add sample size annotations with treatment/control breakdown</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span> 
               <span class="sa">f</span><span class="s1">&#39;T:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n_treated&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/C:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;n_control&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
               <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
    <span class="c1"># Enhanced summary statistics in text box</span>
    <span class="n">overall_ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="n">treatment</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="n">treatment</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">predicted_ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span>
    
    <span class="c1"># Count deciles with both groups</span>
    <span class="n">valid_deciles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_treated&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_control&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">textstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Overall ATE: </span><span class="si">{</span><span class="n">overall_ate</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s1">Predicted ATE: </span><span class="si">{</span><span class="n">predicted_ate</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s1">Valid Deciles: </span><span class="si">{</span><span class="n">valid_deciles</span><span class="si">}</span><span class="s1">/10&#39;</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">uplift_curve_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">UpliftSpec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create uplift curve plot using native implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">cate_estimates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">ate_estimate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No uplift estimates found. Ensure model is fitted.&quot;</span><span class="p">)</span>

    <span class="n">y_true</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">uplift_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">cate_estimates</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">treatment</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">treatment_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_uplift_curve_native</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uplift Curve - </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>




<span class="k">def</span><span class="w"> </span><span class="nf">_extract_event_study_results</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EventStudySpec</span><span class="p">,</span> <span class="n">StaggeredDiDSpec</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">conf_int</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract event study results from EventStudySpec or StaggeredDiDSpec.&quot;&quot;&quot;</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lower_ci</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upper_ci</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">event_pattern_pre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;event_pre(\d+)&#39;</span><span class="p">)</span>   <span class="c1"># For negative periods: event_pre1 = -1</span>
    <span class="n">event_pattern_post</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;event_post(\d+)&#39;</span><span class="p">)</span> <span class="c1"># For positive periods: event_post1 = +1</span>
    
    <span class="c1"># Determine which parameters to check</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">EventStudySpec</span><span class="p">):</span>
        <span class="c1"># For EventStudySpec, use the specific event columns</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">event_cols</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For StaggeredDiDSpec, check all parameters</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c1"># Process parameters to find event study coefficients</span>
    <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Check for pre-treatment period (pre prefix)</span>
        <span class="n">match_pre</span> <span class="o">=</span> <span class="n">event_pattern_pre</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_pre</span><span class="p">:</span>
            <span class="n">period</span> <span class="o">=</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">match_pre</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># Convert to negative number</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">])</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
            <span class="k">continue</span>
            
        <span class="c1"># Check for post-treatment period (post prefix)</span>
        <span class="n">match_post</span> <span class="o">=</span> <span class="n">event_pattern_post</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_post</span><span class="p">:</span>
            <span class="n">period</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_post</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># Already positive</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">])</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
            <span class="k">continue</span>
        
        <span class="c1"># Check for event_period0 (t=0)</span>
        <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;event_period0&#39;</span><span class="p">:</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">])</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">])</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_int</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>
    
    <span class="c1"># Handle reference period</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">EventStudySpec</span><span class="p">):</span>
        <span class="c1"># For EventStudySpec, use the specified reference period</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;reference_period&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">reference_period</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">reference_period</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;reference_period&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
            <span class="c1"># Default to -1 as reference period if not specified</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For StaggeredDiDSpec and other specs, add a reference period</span>
        <span class="c1"># Use -1 as reference period if we have pre-treatment periods, otherwise use 0</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">)</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
            <span class="c1"># If we have pre-treatment periods, use -1 as reference</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
            <span class="c1"># Otherwise use 0 as reference</span>
            <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">lower_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">upper_ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;period&#39;</span><span class="p">:</span> <span class="n">periods</span><span class="p">,</span>
        <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">coeffs</span><span class="p">,</span>
        <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="n">lower_ci</span><span class="p">,</span>
        <span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="n">upper_ci</span>
    <span class="p">})</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">event_study_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">StaggeredDiDSpec</span><span class="p">,</span> <span class="n">EventStudySpec</span><span class="p">],</span> 
                    <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Event Study Plot&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Event Time&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Coefficient Estimate&quot;</span><span class="p">,</span>
                    <span class="n">reference_line_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                    <span class="n">reference_line_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span>
                    <span class="n">effect_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an event study plot from a specification with a fitted model.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: A specification object with fitted model</span>
<span class="sd">        confidence_level: Confidence level for intervals (default: 0.95)</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        title: Plot title</span>
<span class="sd">        xlabel: X-axis label</span>
<span class="sd">        ylabel: Y-axis label</span>
<span class="sd">        reference_line_color: Color for the zero reference line</span>
<span class="sd">        reference_line_style: Line style for the zero reference line</span>
<span class="sd">        effect_color: Color for the effect point estimates</span>
<span class="sd">        marker: Marker style for point estimates</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Matplotlib figure with the event study plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if model exists</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specification must contain a fitted model&quot;</span><span class="p">)</span>

    <span class="c1"># For standard OLS models</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">params</span>
    <span class="n">conf_int</span> <span class="o">=</span> <span class="n">_get_confidence_intervals</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">)</span>
    
    <span class="c1"># Extract results from the specification</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">_extract_event_study_results</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">conf_int</span><span class="p">)</span>

    <span class="c1"># Sort by period</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">)</span>
    
    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Separate reference period from other periods for plotting</span>
    <span class="n">ref_periods</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">non_ref_periods</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Plot non-reference coefficients with markers only (no connecting lines)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">],</span> 
            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">effect_color</span><span class="p">,</span> 
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># This removes the connecting lines</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="c1"># Add error bars (whiskers) with same color as points</span>
    <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> 
            <span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">non_ref_periods</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">],</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> 
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># No additional markers</span>
                <span class="n">ecolor</span><span class="o">=</span><span class="n">effect_color</span><span class="p">,</span>  <span class="c1"># Same color as points</span>
                <span class="n">elinewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">confidence_level</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">% CI&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot reference period</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_periods</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">ref_periods</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">],</span> 
            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>  <span class="c1"># Same marker as other coefficients</span>
            <span class="n">color</span><span class="o">=</span><span class="n">effect_color</span><span class="p">,</span>  <span class="c1"># Same color as other coefficients</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Same size as other coefficients</span>
    
    <span class="c1"># Add zero reference line</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">reference_line_color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">reference_line_style</span><span class="p">)</span>
    
    <span class="c1"># Add vertical line at period 0 (treatment time)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">reference_line_color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">reference_line_style</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
    <span class="c1"># Add grid</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    
    <span class="c1"># Add legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span>


<div class="viewcode-block" id="create_did_plot">
<a class="viewcode-back" href="../../../../api/index.html#pyautocausal.pipelines.library.plots.create_did_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_did_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">DiDSpec</span><span class="p">,</span> 
                   <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                   <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Difference-in-Differences Plot&quot;</span><span class="p">,</span>
                   <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
                   <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Outcome&quot;</span><span class="p">,</span>
                   <span class="n">treatment_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                   <span class="n">control_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                   <span class="n">confidence_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Difference-in-Differences plot showing pre and post trends.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: DiDSpec object with data</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        title: Plot title</span>
<span class="sd">        xlabel: X-axis label</span>
<span class="sd">        ylabel: Y-axis label</span>
<span class="sd">        treatment_color: Color for the treatment group line</span>
<span class="sd">        control_color: Color for the control group line</span>
<span class="sd">        confidence_level: Confidence level for intervals (default: 0.95)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Matplotlib figure with the DiD plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if data exists</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DiD specification must contain data&quot;</span><span class="p">)</span>
    
    <span class="c1"># Extract column names</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span>
    <span class="n">time_col</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">time_col</span>
    <span class="n">unit_col</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">unit_col</span>
    <span class="n">outcome_col</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">outcome_col</span>
    <span class="n">treatment_col</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">treatment_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Use first treatment column</span>
    <span class="n">post_col</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">post_col</span>
    
    <span class="c1"># Aggregate data by time and treatment status with standard error</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">time_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Calculate standard errors for whiskers</span>
    <span class="n">std_errors</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Join means and standard errors</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">std_errors</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">time_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;_se&#39;</span><span class="p">))</span>
    
    <span class="c1"># Calculate confidence interval multiplier</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
    <span class="n">ci_multiplier</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_level</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Calculate confidence intervals</span>
    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ci_lower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ci_multiplier</span> <span class="o">*</span> <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_se&#39;</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ci_upper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ci_multiplier</span> <span class="o">*</span> <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_se&#39;</span><span class="p">]</span>
    
    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Plot treatment group with error bars (no connecting lines)</span>
    <span class="n">treated_data</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">treated_data</span><span class="p">[</span><span class="n">time_col</span><span class="p">],</span> <span class="n">treated_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">],</span> 
              <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">treated_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">treated_data</span><span class="p">[</span><span class="s1">&#39;ci_lower&#39;</span><span class="p">],</span> 
                    <span class="n">treated_data</span><span class="p">[</span><span class="s1">&#39;ci_upper&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">treated_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]],</span>
              <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">treatment_color</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">treatment_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
              <span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Treatment Group&#39;</span><span class="p">,</span>
              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>  <span class="c1"># Remove connecting lines</span>
    
    <span class="c1"># Plot control group with error bars (no connecting lines)</span>
    <span class="n">control_data</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">control_data</span><span class="p">[</span><span class="n">time_col</span><span class="p">],</span> <span class="n">control_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">],</span> 
              <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">control_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">control_data</span><span class="p">[</span><span class="s1">&#39;ci_lower&#39;</span><span class="p">],</span> 
                    <span class="n">control_data</span><span class="p">[</span><span class="s1">&#39;ci_upper&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">control_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome_col</span><span class="si">}</span><span class="s1">_mean&#39;</span><span class="p">]],</span>
              <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">control_color</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">control_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
              <span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control Group&#39;</span><span class="p">,</span>
              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>  <span class="c1"># Remove connecting lines</span>
    
    <span class="c1"># Find treatment timing (first period where post==1 for treated units)</span>
    <span class="n">first_post_period</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">post_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)][</span><span class="n">time_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    
    <span class="c1"># Add vertical line for treatment timing</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">first_post_period</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">first_post_period</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Treatment Time (</span><span class="si">{</span><span class="n">first_post_period</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
    <span class="c1"># Add grid</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    
    <span class="c1"># Add legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span></div>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">synthdid_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">output_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OutputConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a synthetic difference-in-differences plot.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: A SynthDIDSpec object with fitted model</span>
<span class="sd">        output_config: Configuration for saving the plot</span>
<span class="sd">        **kwargs: Additional arguments passed to plot_synthdid</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib figure object</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Create the plot using the synthdid plotting function</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_synthdid</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Save if output config provided</span>
    <span class="k">if</span> <span class="n">output_config</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">output_config</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">PNG</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_config</span><span class="o">.</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> 
                       <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_config</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">PDF</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_config</span><span class="o">.</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">,</span> 
                       <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">callaway_santanna_summary_table</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">StaggeredDiDSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a comprehensive summary table for Callaway &amp; Sant&#39;Anna results.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: StaggeredDiDSpec with fitted Callaway &amp; Sant&#39;Anna model using csdid</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with formatted results table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;att_gt_object&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Callaway &amp; Sant&#39;Anna csdid results found in spec.model&quot;</span><span class="p">)</span>
    
    <span class="n">att_gt</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;att_gt_object&#39;</span><span class="p">]</span>
    
    <span class="c1"># Get the summary table from the att_gt object</span>
    <span class="n">summary_table</span> <span class="o">=</span> <span class="n">att_gt</span><span class="o">.</span><span class="n">summary2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Round numerical columns for better presentation</span>
    <span class="n">numerical_cols</span> <span class="o">=</span> <span class="n">summary_table</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numerical_cols</span><span class="p">:</span>
        <span class="n">summary_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">summary_table</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">callaway_santanna_group_event_plot</span><span class="p">(</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">StaggeredDiDSpec</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Group-Time Treatment Effects (Callaway &amp; Sant&#39;Anna)&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Time Period&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ATT Estimate&quot;</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create group-specific treatment effect plots using the csdid module.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: StaggeredDiDSpec with fitted Callaway &amp; Sant&#39;Anna model</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        title: Plot title</span>
<span class="sd">        xlabel: X-axis label</span>
<span class="sd">        ylabel: Y-axis label</span>
<span class="sd">        save_path: Optional path to save the plot</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Matplotlib figure with group-specific plots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;att_gt_object&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Callaway &amp; Sant&#39;Anna csdid results found in spec.model&quot;</span><span class="p">)</span>
    
    <span class="n">att_gt</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;att_gt_object&#39;</span><span class="p">]</span>
    
    <span class="c1"># Close any existing figures to avoid multiple windows</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    
    <span class="c1"># Use the ATTgt plotting method - it will create its own figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">att_gt</span><span class="o">.</span><span class="n">plot_attgt</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">xlab</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
        <span class="n">ylab</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
        <span class="n">theming</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ref_line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    
    <span class="c1"># Set the figure size</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="c1"># Save if path provided</span>
    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">callaway_santanna_comprehensive_results</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">StaggeredDiDSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate simplified results summary for Callaway &amp; Sant&#39;Anna estimation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: StaggeredDiDSpec with fitted Callaway &amp; Sant&#39;Anna model</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Formatted string with key results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;att_gt_object&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Callaway &amp; Sant&#39;Anna csdid results found in spec.model&quot;</span><span class="p">)</span>
    
    <span class="n">att_gt</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;att_gt_object&#39;</span><span class="p">]</span>
    <span class="n">overall_effect</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overall_effect&#39;</span><span class="p">)</span>
    <span class="n">control_group</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;control_group&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
    
    <span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    
    <span class="c1"># Header</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALLAWAY &amp; SANT&#39;ANNA DiD RESULTS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Control Group: </span><span class="si">{</span><span class="n">control_group</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> obs, </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">unit_col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2"> units</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Overall ATT - simplified and safer</span>
    <span class="k">if</span> <span class="n">overall_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">overall_att</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">overall_effect</span><span class="o">.</span><span class="n">atte</span><span class="p">[</span><span class="s1">&#39;overall_att&#39;</span><span class="p">])</span>
            <span class="n">overall_se</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">overall_effect</span><span class="o">.</span><span class="n">atte</span><span class="p">[</span><span class="s1">&#39;overall_se&#39;</span><span class="p">])</span>
            
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;OVERALL TREATMENT EFFECT:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ATT:        </span><span class="si">{</span><span class="n">overall_att</span><span class="si">:</span><span class="s2">&gt;8.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Std Error:  </span><span class="si">{</span><span class="n">overall_se</span><span class="si">:</span><span class="s2">&gt;8.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Calculate confidence intervals</span>
            <span class="n">ci_lower</span> <span class="o">=</span> <span class="n">overall_att</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">overall_se</span>
            <span class="n">ci_upper</span> <span class="o">=</span> <span class="n">overall_att</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">overall_se</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;95% CI:     [</span><span class="si">{</span><span class="n">ci_lower</span><span class="si">:</span><span class="s2">&gt;7.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ci_upper</span><span class="si">:</span><span class="s2">&gt;7.4f</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Simple significance test</span>
            <span class="k">if</span> <span class="n">overall_se</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t_stat</span> <span class="o">=</span> <span class="n">overall_att</span> <span class="o">/</span> <span class="n">overall_se</span>
                <span class="n">significance</span> <span class="o">=</span> <span class="s2">&quot;***&quot;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_stat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.58</span> <span class="k">else</span> <span class="s2">&quot;**&quot;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_stat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.96</span> <span class="k">else</span> <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t_stat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.64</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Significant: </span><span class="si">{</span><span class="n">significance</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">significance</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall effect formatting error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Simple summary table - just use the built-in summary</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DETAILED RESULTS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">summary_table</span> <span class="o">=</span> <span class="n">att_gt</span><span class="o">.</span><span class="n">summary2</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">summary_table</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary table error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note: *** p&lt;0.01, ** p&lt;0.05, * p&lt;0.1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>


<span class="nd">@make_transformable</span>  
<span class="k">def</span><span class="w"> </span><span class="nf">callaway_santana_event_study_plot</span><span class="p">(</span>
    <span class="n">spec</span><span class="p">:</span> <span class="n">StaggeredDiDSpec</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create comprehensive diagnostic plots for Callaway &amp; Sant&#39;Anna estimation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: StaggeredDiDSpec with fitted Callaway &amp; Sant&#39;Anna model</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        save_path: Optional path to save the plot</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Matplotlib figure with multiple diagnostic subplots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;att_gt_object&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Callaway &amp; Sant&#39;Anna csdid results found in spec.model&quot;</span><span class="p">)</span>
    
    <span class="n">att_gt</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;att_gt_object&#39;</span><span class="p">]</span>
    <span class="n">overall_effect</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overall_effect&#39;</span><span class="p">)</span>
    <span class="n">dynamic_effects</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dynamic_effects&#39;</span><span class="p">)</span>
    <span class="n">group_effects</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group_effects&#39;</span><span class="p">)</span>
    
    <span class="c1"># Create subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Callaway &amp; Sant</span><span class="se">\&#39;</span><span class="s1">Anna DiD - Comprehensive Results&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="c1"># Get the dynamic effects object</span>
    <span class="n">dynamic_effects</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;dynamic_effects&#39;</span><span class="p">]</span>
    
    <span class="c1"># Use the built-in plotting function from att_gt instead of manual plotting</span>
    <span class="c1"># This ensures we get the correct event times</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>  <span class="c1"># Close any existing plots</span>
    
    <span class="c1"># Manual plotting using the aggregated results</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dynamic_effects</span><span class="p">,</span> <span class="s1">&#39;atte&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dynamic_effects</span><span class="o">.</span><span class="n">atte</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">atte_results</span> <span class="o">=</span> <span class="n">dynamic_effects</span><span class="o">.</span><span class="n">atte</span>
        <span class="n">event_times</span> <span class="o">=</span> <span class="n">atte_results</span><span class="p">[</span><span class="s1">&#39;egt&#39;</span><span class="p">]</span>
        <span class="n">att_estimates</span> <span class="o">=</span> <span class="n">atte_results</span><span class="p">[</span><span class="s1">&#39;att_egt&#39;</span><span class="p">]</span> 
        <span class="n">se_estimates</span> <span class="o">=</span> <span class="n">atte_results</span><span class="p">[</span><span class="s1">&#39;se_egt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># se_egt is usually a list with one element</span>
        
        <span class="c1"># Create the plot manually</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">event_times</span><span class="p">,</span> <span class="n">att_estimates</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">1.96</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">se_estimates</span><span class="p">),</span> 
                   <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Event Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ATT&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Dynamic Treatment Effects&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Save if path provided</span>
        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dynamic effects object does not have aggregated results&quot;</span><span class="p">)</span>

<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hainmueller_synth_effect_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                          <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a plot for Hainmueeller synthetic effect size.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: A SynthDIDSpec object with fitted Hainmueeller model</span>
<span class="sd">        output_config: Configuration for saving the plot</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        **kwargs: Additional arguments for plot customization</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib figure object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Call the plot method - it will handle display appropriately based on environment</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">hainmueller_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;pointwise&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulative&quot;</span><span class="p">],</span> 
        <span class="n">treated_label</span><span class="o">=</span><span class="s2">&quot;Treated Unit&quot;</span><span class="p">,</span> 
        <span class="n">synth_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Synthetic Control&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hainmueller_synth_validity_plot</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                          <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a plot for Hainmueeller synthetic control results with placebo tests.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: A SynthDIDSpec object with fitted Hainmueeller model</span>
<span class="sd">        output_config: Configuration for saving the plot</span>
<span class="sd">        figsize: Figure size as (width, height)</span>
<span class="sd">        **kwargs: Additional arguments for plot customization</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib figure object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Call the plot method - it will handle display appropriately based on environment</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">hainmueller_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;in-space placebo&quot;</span><span class="p">,</span> <span class="s2">&quot;in-time placebo&quot;</span><span class="p">],</span> 
        <span class="n">treated_label</span><span class="o">=</span><span class="s2">&quot;Treated Unit&quot;</span><span class="p">,</span> 
        <span class="n">synth_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Synthetic Control&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_balance_coefficients</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create horizontal error bar plot showing standardized coefficients for balance tests.</span>
<span class="sd">    </span>
<span class="sd">    Shows point estimates with horizontal error bars and vertical dashed line at 0.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: Specification object with balance_stats attribute containing balance results</span>
<span class="sd">        **kwargs: Additional plotting arguments</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib Figure object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;balance_stats&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No balance statistics found. Run balance tests first.&quot;</span><span class="p">)</span>
    
    <span class="n">balance_df</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">balance_stats</span>
    
    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_df</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)))</span>
    
    <span class="c1"># Extract data for plotting</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;covariate&#39;</span><span class="p">]</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span>
    <span class="n">std_errors</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;se_diff&#39;</span><span class="p">]</span>
    
    <span class="c1"># Create y positions</span>
    <span class="n">y_positions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
    
    <span class="c1"># Plot horizontal error bars with point estimates</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">y_positions</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std_errors</span><span class="p">,</span> 
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="c1"># Add vertical reference line at 0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Customize plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_positions</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Standardized Coefficient (95% CI)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Covariates&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Balance Test Results&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add grid for easier reading</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span>



<span class="k">def</span><span class="w"> </span><span class="nf">_plot_uplift_curve_imbalanced</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uplift curve plotting optimized for highly imbalanced datasets.</span>
<span class="sd">    </span>
<span class="sd">    Uses cumulative gains and response rates instead of deciles when </span>
<span class="sd">    treatment/control groups are severely imbalanced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
    
    <span class="c1"># Create analysis dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s1">&#39;uplift&#39;</span><span class="p">:</span> <span class="n">uplift_scores</span><span class="p">,</span>
        <span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment</span>
    <span class="p">})</span>
    
    <span class="c1"># DEBUG: Print raw input data characteristics</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: RAW INPUT DATA:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Total observations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Uplift scores range: [</span><span class="si">{</span><span class="n">uplift_scores</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">uplift_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Uplift scores std: </span><span class="si">{</span><span class="n">uplift_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Unique uplift values: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Non-zero uplift values: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Treatment distribution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Outcome distribution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Sort by uplift score (descending)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;uplift&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># DEBUG: Print sorted data sample</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: SORTED DATA SAMPLE (first 20 rows):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)[[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;uplift&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: SORTED DATA SAMPLE (last 20 rows):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">)[[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;uplift&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
    
    <span class="c1"># Check treatment balance</span>
    <span class="n">treatment_balance</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Treatment proportion: </span><span class="si">{</span><span class="n">treatment_balance</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># For severely imbalanced data, use cumulative approach instead of deciles</span>
    <span class="k">if</span> <span class="n">treatment_balance</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="ow">or</span> <span class="n">treatment_balance</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using cumulative approach for imbalanced data&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create percentile groups</span>
        <span class="n">n_groups</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">group_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="n">n_groups</span>
        
        <span class="c1"># Calculate cumulative and incremental metrics</span>
        <span class="n">cumulative_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_groups</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Take top i*10% of predictions</span>
            <span class="n">top_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span> <span class="o">*</span> <span class="n">group_size</span><span class="p">]</span>
            
            <span class="c1"># Calculate cumulative metrics</span>
            <span class="n">treated</span> <span class="o">=</span> <span class="n">top_data</span><span class="p">[</span><span class="n">top_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">control</span> <span class="o">=</span> <span class="n">top_data</span><span class="p">[</span><span class="n">top_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            
            <span class="n">treated_rate</span> <span class="o">=</span> <span class="n">treated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">treated</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">control_rate</span> <span class="o">=</span> <span class="n">control</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">control</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">uplift</span> <span class="o">=</span> <span class="n">treated_rate</span> <span class="o">-</span> <span class="n">control_rate</span>
            
            <span class="c1"># Calculate incremental lift for this decile only</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">incremental_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">group_size</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">incremental_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">group_size</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="n">group_size</span><span class="p">]</span>
            
            <span class="n">inc_treated</span> <span class="o">=</span> <span class="n">incremental_data</span><span class="p">[</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">inc_control</span> <span class="o">=</span> <span class="n">incremental_data</span><span class="p">[</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">inc_treated_rate</span> <span class="o">=</span> <span class="n">inc_treated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_treated</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">inc_control_rate</span> <span class="o">=</span> <span class="n">inc_control</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_control</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">inc_uplift</span> <span class="o">=</span> <span class="n">inc_treated_rate</span> <span class="o">-</span> <span class="n">inc_control_rate</span>
            
            <span class="c1"># DEBUG: Print detailed calculations</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  DECILE </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> CALCULATION DETAILS:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Incremental data range: [</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">group_size</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="n">group_size</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Inc Treated: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inc_treated</span><span class="p">)</span><span class="si">}</span><span class="s2"> obs, </span><span class="si">{</span><span class="n">inc_treated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> conversions, rate=</span><span class="si">{</span><span class="n">inc_treated_rate</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Inc Control: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inc_control</span><span class="p">)</span><span class="si">}</span><span class="s2"> obs, </span><span class="si">{</span><span class="n">inc_control</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> conversions, rate=</span><span class="si">{</span><span class="n">inc_control_rate</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Inc Uplift: </span><span class="si">{</span><span class="n">inc_treated_rate</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">inc_control_rate</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">inc_uplift</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Uplift Score Range: [</span><span class="si">{</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            
            <span class="c1"># Additional debugging for zero uplifts</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">inc_uplift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    WARNING: Near-zero uplift detected!&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Treated outcomes: </span><span class="si">{</span><span class="n">inc_treated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>  <span class="c1"># First 10 values</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Control outcomes: </span><span class="si">{</span><span class="n">inc_control</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>  <span class="c1"># First 10 values</span>
            
            <span class="n">cumulative_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;percentile&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;cumulative_uplift&#39;</span><span class="p">:</span> <span class="n">uplift</span><span class="p">,</span>
                <span class="s1">&#39;incremental_uplift&#39;</span><span class="p">:</span> <span class="n">inc_uplift</span><span class="p">,</span>
                <span class="s1">&#39;n_treated&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">treated</span><span class="p">),</span>
                <span class="s1">&#39;n_control&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">control</span><span class="p">),</span>
                <span class="s1">&#39;inc_n_treated&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_treated</span><span class="p">),</span>
                <span class="s1">&#39;inc_n_control&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_control</span><span class="p">),</span>
                <span class="s1">&#39;treated_rate&#39;</span><span class="p">:</span> <span class="n">treated_rate</span><span class="p">,</span>
                <span class="s1">&#39;control_rate&#39;</span><span class="p">:</span> <span class="n">control_rate</span><span class="p">,</span>
                <span class="s1">&#39;inc_treated_rate&#39;</span><span class="p">:</span> <span class="n">inc_treated_rate</span><span class="p">,</span>
                <span class="s1">&#39;inc_control_rate&#39;</span><span class="p">:</span> <span class="n">inc_control_rate</span><span class="p">,</span>
                <span class="s1">&#39;uplift_score_range&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incremental_data</span><span class="p">[</span><span class="s1">&#39;uplift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">]&quot;</span>
            <span class="p">})</span>
        
        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cumulative_results</span><span class="p">)</span>
        
        <span class="c1"># Print detailed diagnostic information</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG: Cumulative Analysis Results:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentile&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">%: cum_uplift=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cumulative_uplift&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;inc_uplift=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;incremental_uplift&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;T:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_treated&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/C:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_control&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;scores=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;uplift_score_range&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create subplot layout</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Plot 1: Cumulative uplift</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;percentile&#39;</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;cumulative_uplift&#39;</span><span class="p">]</span>
        
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cumulative Uplift&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Top </span><span class="si">% o</span><span class="s1">f Predictions&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Uplift&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cumulative Uplift Curve (Top % Targeting)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="c1"># Adjust y-axis to show small values clearly</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y1</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y1</span><span class="o">.</span><span class="n">max</span><span class="p">())))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
        
        <span class="c1"># Add value labels</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">)):</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">yi</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> 
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="c1"># Plot 2: Incremental uplift by decile</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;incremental_uplift&#39;</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkred&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.0001</span> <span class="k">else</span> <span class="s1">&#39;darkgreen&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.0001</span> <span class="k">else</span> <span class="s1">&#39;gray&#39;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">]</span>
        
        <span class="c1"># Adjust y-axis for small values (calculate first)</span>
        <span class="n">y2_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y2</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y2</span><span class="o">.</span><span class="n">max</span><span class="p">())))</span>
        
        <span class="c1"># DEBUG: Print exact values being plotted</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DEBUG: BAR CHART VALUES BEING PLOTTED:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;percentile&#39;</span><span class="p">],</span> <span class="n">y2</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Bar </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> (Top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">percentile</span><span class="p">)</span><span class="si">}</span><span class="s2">%): </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> (color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Y-axis range will be: [</span><span class="si">{</span><span class="o">-</span><span class="n">y2_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y2_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.2</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max absolute value: </span><span class="si">{</span><span class="n">y2_max</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">bars</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Decile (Top 10%, 20%, etc.)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Incremental Uplift&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Incremental Uplift by Decile&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Set y-axis limits</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">y2_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
        
        <span class="c1"># DEBUG: Print bar heights after plotting</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DEBUG: ACTUAL BAR HEIGHTS:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars</span><span class="p">):</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Bar </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: height=</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, visible=</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e-10</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add value labels for incremental with higher precision</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">y2</span><span class="p">)):</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            
            <span class="c1"># Get conversion info for this decile</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">treated_conversions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_treated&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_treated_rate&#39;</span><span class="p">])</span>
            <span class="n">control_conversions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_control&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_control_rate&#39;</span><span class="p">])</span>
            <span class="n">has_conversions</span> <span class="o">=</span> <span class="n">treated_conversions</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">control_conversions</span> <span class="o">&gt;</span> <span class="mi">0</span>
            
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>  <span class="c1"># Non-zero uplift</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="n">y2_max</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">yi</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Zero uplift</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_conversions</span><span class="p">:</span>
                    <span class="c1"># No conversions in this decile</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span>
                            <span class="s1">&#39;No</span><span class="se">\n</span><span class="s1">Conversions&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> 
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Has conversions but zero uplift</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">yi</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="c1"># Add sample size info with conversion counts</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">treated_conversions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_treated&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_treated_rate&#39;</span><span class="p">])</span>
            <span class="n">control_conversions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_control&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_control_rate&#39;</span><span class="p">])</span>
            
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentile&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">y2_max</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;T:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;inc_n_treated&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/C:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;inc_n_control&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            
            <span class="c1"># Add conversion counts below</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentile&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">y2_max</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;Conv: </span><span class="si">{</span><span class="n">treated_conversions</span><span class="si">}</span><span class="s1">+</span><span class="si">{</span><span class="n">control_conversions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">)</span>
        
        <span class="c1"># Add data sparsity warning if applicable</span>
        <span class="n">total_conversions</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_treated&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_treated_rate&#39;</span><span class="p">])</span> <span class="o">+</span> 
                              <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_n_control&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;inc_control_rate&#39;</span><span class="p">])</span> 
                              <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
        <span class="n">zero_deciles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span> 
                          <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;incremental_uplift&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">zero_deciles</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># Most deciles have zero uplift</span>
            <span class="n">warning_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; Extremely Sparse Data</span><span class="se">\n</span><span class="si">{</span><span class="n">total_conversions</span><span class="si">}</span><span class="s1"> total conversions</span><span class="se">\n</span><span class="si">{</span><span class="n">zero_deciles</span><span class="si">}</span><span class="s1">/10 deciles have no conversions&#39;</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">warning_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For balanced data, use the standard decile approach</span>
        <span class="k">return</span> <span class="n">_plot_uplift_curve_native</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">uplift_curve_plot_adaptive</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="n">UpliftSpec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create adaptive uplift curve plot that handles both balanced and imbalanced datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">cate_estimates</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">ate_estimate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No uplift estimates found. Ensure model is fitted.&quot;</span><span class="p">)</span>

    <span class="n">y_true</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">outcome_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">uplift_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">cate_estimates</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">treatment</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">treatment_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Diagnostic information</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DIAGNOSTIC: </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> Uplift Analysis&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - CATE range: [</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - CATE std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ATE: </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">ate_estimate</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Non-zero CATE values: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check for severe imbalance</span>
    <span class="n">treatment_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span>
    
    <span class="c1"># Check for very low heterogeneity</span>
    <span class="n">heterogeneity_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">uplift_scores</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">treatment_prop</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="ow">or</span> <span class="n">treatment_prop</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Using imbalanced approach (treatment prop: </span><span class="si">{</span><span class="n">treatment_prop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">_plot_uplift_curve_imbalanced</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adaptive Uplift Analysis - </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="c1"># Add diagnostic text to the plot</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Heterogeneity: </span><span class="si">{</span><span class="n">heterogeneity_level</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                        <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adaptive Uplift Analysis - </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Using standard approach (treatment prop: </span><span class="si">{</span><span class="n">treatment_prop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_uplift_curve_native</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">uplift_scores</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uplift Curve - </span><span class="si">{</span><span class="n">spec</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="c1"># Add diagnostic text to the plot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Heterogeneity: </span><span class="si">{</span><span class="n">heterogeneity_level</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
               <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
               <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">fig</span>


<span class="nd">@make_transformable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_balance_coefficients</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create horizontal error bar plot showing standardized coefficients for balance tests.</span>
<span class="sd">    </span>
<span class="sd">    Shows point estimates with horizontal error bars and vertical dashed line at 0.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        spec: Specification object with balance_stats attribute containing balance results</span>
<span class="sd">        **kwargs: Additional plotting arguments</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matplotlib Figure object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;balance_stats&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No balance statistics found. Run balance tests first.&quot;</span><span class="p">)</span>
    
    <span class="n">balance_df</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">balance_stats</span>
    
    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">balance_df</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">)))</span>
    
    <span class="c1"># Extract data for plotting</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;covariate&#39;</span><span class="p">]</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span>
    <span class="n">std_errors</span> <span class="o">=</span> <span class="n">balance_df</span><span class="p">[</span><span class="s1">&#39;se_diff&#39;</span><span class="p">]</span>
    
    <span class="c1"># Create y positions</span>
    <span class="n">y_positions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
    
    <span class="c1"># Plot horizontal error bars with point estimates</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">y_positions</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">1.96</span><span class="o">*</span><span class="n">std_errors</span><span class="p">,</span> 
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="c1"># Add vertical reference line at 0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Customize plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_positions</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Standardized Coefficient (95% CI)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Covariates&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Balance Test Results&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add grid for easier reading</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Nicholas Topousis, Yogam Tchokni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>